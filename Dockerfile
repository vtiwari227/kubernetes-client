#
# Copyright (C) 2015 Red Hat, Inc.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#         http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

FROM centos:7

RUN yum update -y && \
  yum install -y centos-release-scl && \
  yum install -y docker sclo-git212-git unzip java-1.8.0-openjdk-devel java-1.8.0-openjdk-devel.i686 which && \
  yum clean all

# Enable packages installed from SCL
#
# This approach is a hack, but is the only option that worked well with bash and
# sh in both interactive and non interactive modes.
#
# 1. Standard `scl enable`, `scl_source` etc wont work because each `RUN`
# statement spawns a new subshell and the changes in ENV is not persistent.
#
# 2. Sourcing files is hard because there is no file that is read by bash and sh
# in both interactive and non interactive modes.
#
# 3. Setting $ENV and $BASH_ENV to a file that executes commands from 1 didn't
# work with non interactive shells even though the docs says it will.
#
# If you would like to change this, you can test it with following commands
#
# `docker run <image> sh -c 'git --version'`
# `docker run <image> bash -c 'git --version'`
# `docker run <image> sh -ic 'git --version'`
# `docker run <image> bash -c 'git --version'`

ENV PATH=/opt/rh/sclo-git212/root/bin:$PATH

RUN curl --retry 999 --retry-max-time 0  -sSL https://bintray.com/artifact/download/fabric8io/helm-ci/helm-v0.1.0%2B825f5ef-linux-amd64.zip > helm.zip && \
  unzip helm.zip && \
  rm -f helm.zip && \
  mv helm /usr/bin/

ARG PUBRING 
ARG SEC_JENKINS 
ARG SECRING 
ARG TRUSTDB 
ARG GPG_PASSPHRASE 
ARG SONATYPE_USERNAME 
ARG SONATYPE_PASSWORD

# put gpg keys in gpg home directory
ENV GPG_HOME $HOME/.gnupg \
  GPG_PASSPHRASE $GPG_PASSPRHASE

RUN PUBRING=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


RUN SECRING=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
RUN TRUSTDB=AWdwZwMDAQUBAgAAVfld3wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA

#RUN echo $PUBRING | base64 --decode > $HOME/.gnupg/pubring.gpg
#RUN echo $SEC_JENKINS |  base64 --decode > $HOME/.gnupg/sec_jenkins.gpg
#RUN echo $SECRING | base64 --decode > $HOME/.gnupg/secring.gpg
#RUN echo $TRUSTDB | base64 --decode > $HOME/.gnupg/trustdb.gpg

# Maven
RUN curl -L http://mirrors.ukfast.co.uk/sites/ftp.apache.org/maven/maven-3/3.3.9/binaries/apache-maven-3.3.9-bin.tar.gz | tar -C /opt -xzv

ENV M2_HOME /opt/apache-maven-3.3.9
ENV maven.home $M2_HOME
ENV M2 $M2_HOME/bin
ENV PATH $M2:$PATH
RUN mkdir --parents --mode 777 /root/.mvnrepository

RUN mkdir /root/.m2/

RUN curl https://raw.githubusercontent.com/fabric8io/cico-bash-library/master/settings.xml > /root/.m2/settings.xml

RUN sed -i 's/env.${SONATYPE_USERNAME}/jstrachan/' /root/.m2/settings.xml

RUN  sed -i 's/env.${SONATYPE_PASSWORD}/sp33d0/' /root/.m2/settings.xml

# Set JDK to be 32bit
#COPY set_java $M2
#RUN $M2/set_java && rm $M2/set_java
#RUN java -version

# hub
RUN curl -L https://github.com/github/hub/releases/download/v2.2.3/hub-linux-amd64-2.2.3.tgz | tar xzv && \
  mv hub-linux-amd64-2.2.3/bin/hub /usr/bin/ && \
  rm -rf hub-linux-amd64-2.2.3

# exposecontroller
ENV EXPOSECONTROLLER_VERSION 2.3.27
RUN curl -L https://github.com/fabric8io/exposecontroller/releases/download/v$EXPOSECONTROLLER_VERSION/exposecontroller-linux-amd64 > exposecontroller && \
  chmod +x exposecontroller && \
  mv exposecontroller /usr/bin/

# install grab
RUN curl -s https://raw.githubusercontent.com/shellib/grab/master/install.sh | bash

# updatebot
ENV UPDATEBOT_VERSION 1.0.5
RUN curl -L http://central.maven.org/maven2/io/fabric8/updatebot/updatebot/$UPDATEBOT_VERSION/updatebot-$UPDATEBOT_VERSION.jar -o /usr/bin/updatebot && chmod +x /usr/bin/updatebot

ENV FABRIC8_USER_NAME=fabric8
RUN useradd --user-group --create-home --shell /bin/false ${FABRIC8_USER_NAME}
ENV HOME=/home/${FABRIC8_USER_NAME}
ENV WORKSPACE=$HOME/workspace
RUN mkdir $WORKSPACE
COPY . $WORKSPACE

RUN mkdir $HOME/.gnupg
RUN echo $PUBRING | base64 --decode > $HOME/.gnupg/pubring.gpg
RUN echo $SEC_JENKINS |  base64 --decode > $HOME/.gnupg/sec_jenkins.gpg
RUN echo $SECRING | base64 --decode > $HOME/.gnupg/secring.gpg
RUN echo $TRUSTDB | base64 --decode > $HOME/.gnupg/trustdb.gpg
WORKDIR $WORKSPACE/ 
